<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resumen del Pedido</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos para mejorar la apariencia */
        body { background-color: #f8f9fa; }
        .container { max-width: 900px; background-color: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-top: 2rem; }
        .total-section { text-align: right; font-size: 1.5rem; font-weight: bold; color: #198754; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 2px solid #dee2e6; }
        .btn-generar { font-size: 1.1rem; padding: 0.75rem 1.5rem; }
        .table thead { background-color: #e9ecef; }
        /* Estilos para el buscador de clientes */
        .search-container { position: relative; }
        #clienteSearchResults {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 1050; /* Asegura que esté sobre otros elementos */
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-top: none;
            border-radius: 0 0 .375rem .375rem;
        }
    </style>
</head>
<body>
<div class="container">
    <h2 class="text-center my-4">Resumen del Pedido</h2>

    <!-- Buscador de Cliente Mejorado -->
    <div class="mb-4">
        <label for="clienteSearchInput" class="form-label fw-bold fs-5">Seleccionar Cliente:</label>
        <div id="clienteErrorAlert" class="alert alert-danger d-none" role="alert"></div>

        <div class="search-container">
            <div class="input-group">
                <input type="text" id="clienteSearchInput" class="form-control form-control-lg" placeholder="Buscar cliente por nombre o DNI..." autocomplete="off">
                <button class="btn btn-outline-primary" type="button" id="btnNuevoCliente" title="Agregar Nuevo Cliente">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/></svg>
                    Nuevo
                </button>
            </div>
            <div id="clienteSearchResults" class="list-group d-none"></div>
        </div>
        <input type="hidden" id="selectedClienteId">
    </div>

    <div class="mb-4">
        <label class="form-label fw-bold fs-5">Pedido registrado por:</label>
        <div id="usuarioErrorAlert" class="alert alert-warning d-none" role="alert">
            No se ha detectado un usuario. Por favor, <a href="login.html">inicie sesión</a> para poder guardar pedidos.
        </div>
        <div id="usuarioInfo" class="alert alert-info">
            Cargando información del usuario...
        </div>
    </div>

    <!-- Tablas de Resumen -->
    <div class="table-responsive">
        <h5>Platos y Entradas</h5>
        <table class="table table-hover align-middle">
            <thead>
            <tr>
                <th>Item</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Subtotal</th>
                <th class="text-center">Acciones</th>
            </tr>
            </thead>
            <tbody id="detallesComidas"></tbody>
        </table>

        <h5 class="mt-4">Bebidas</h5>
        <table class="table table-hover align-middle">
            <thead>
            <tr>
                <th>Bebida</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Subtotal</th>
                <th class="text-center">Acciones</th>
            </tr>
            </thead>
            <tbody id="detallesBebidas"></tbody>
        </table>
    </div>

    <!-- Total y Botones -->
    <div id="total-container" class="total-section">
        <span>TOTAL:</span>
        <span id="total-pedido">S/. 0.00</span>
    </div>

    <div class="d-flex justify-content-between mt-5">
        <!-- ✅✅✅ INICIO DE LA CORRECCIÓN ✅✅✅ -->
        <!-- Se apunta a la URL del controlador (/platos) en lugar del archivo (platos.html) -->
        <a href="/platos" class="btn btn-secondary">Volver al Menú</a>
        <!-- ✅✅✅ FIN DE LA CORRECCIÓN ✅✅✅ -->
        <div> <!-- Contenedor para alinear botones a la derecha -->
            <button class="btn btn-info btn-lg" id="btn-guardar-borrador">
                Guardar Borrador
            </button>
            <button class="btn btn-success btn-lg btn-generar" id="btn-generar-pedido">
                Finalizar y Guardar Pedido
            </button>
        </div>
    </div>

    <div id="pedidoErrorContainer" class="alert alert-danger mt-4 d-none" role="alert">
        <h4 class="alert-heading">¡Error al Guardar!</h4>
        <p id="pedidoErrorMessage"></p>
        <hr>
        <p class="mb-0"><strong>Detalles Técnicos:</strong></p>
        <pre id="pedidoErrorDetails" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
    </div>
</div>

<!-- Modal para Nuevo Cliente -->
<div class="modal fade" id="nuevoClienteModal" tabindex="-1" aria-labelledby="nuevoClienteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="nuevoClienteModalLabel">Registrar Nuevo Cliente Particular</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="modalClienteErrorAlert" class="alert alert-danger d-none"></div>
                <div class="mb-3">
                    <label for="nuevoClienteNombre" class="form-label">Nombre Completo *</label>
                    <input type="text" class="form-control" id="nuevoClienteNombre" required placeholder="Ej: Juan Pérez">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnGuardarNuevoCliente">Guardar Cliente</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/resumen.js"></script>
</body>
</html>